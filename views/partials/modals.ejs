<!-- Edit Order Modal -->
<div id="editOrderModal"
    class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[9999] hidden flex items-center justify-center overflow-y-auto py-10">
    <div
        class="bg-white rounded-3xl shadow-2xl w-full max-w-3xl mx-4 transform transition-all scale-100 flex flex-col max-h-[90vh]">
        <!-- Header -->
        <div class="sticky top-0 bg-orange-600 text-white p-4 rounded-t-3xl flex justify-between items-center z-10">
            <h3 class="font-bold text-lg">âœï¸ Edit Order - <span id="editOrderIdDisplay"></span></h3>
            <button type="button" onclick="closeModal('editOrderModal')"
                class="text-2xl hover:bg-white/20 w-8 h-8 rounded-full">Ã—</button>
        </div>

        <!-- Dynamic Content Container - app.js will populate this -->
        <div id="editOrderModalContent" class="p-6 overflow-y-auto">
            <!-- Content will be injected by openEditOrderModal function -->
            <div class="text-center py-8 text-gray-500">Loading...</div>
        </div>
    </div>
</div>

<!-- Order Details Modal -->
<div id="orderModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
    <div class="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div class="sticky top-0 bg-emerald-600 text-white p-4 rounded-t-2xl flex justify-between items-center">
            <h3 class="font-bold text-lg">ğŸ“‹ Order Details</h3>
            <button type="button" onclick="closeModal('orderModal')"
                class="text-2xl hover:bg-white/20 w-8 h-8 rounded-full">Ã—</button>
        </div>
        <div id="orderModalContent" class="p-6"></div>
    </div>
</div>

<!-- Dispatch Modal -->
<div id="dispatchModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
    <div class="bg-white rounded-2xl max-w-md w-full">
        <div class="bg-purple-600 text-white p-4 rounded-t-2xl">
            <h3 class="font-bold text-lg">ğŸ“¦ Dispatch Order</h3>
        </div>
        <div class="p-6 space-y-4">
            <input type="hidden" id="dispatchOrderId">
            <div>
                <label class="block text-sm font-medium mb-1">Courier Company</label>
                <select id="dispatchCourier" class="w-full border-2 rounded-xl px-4 py-3">
                    <option value="">-- Select Courier --</option>
                    <option value="India Post">India Post</option>
                    <option value="DTDC">DTDC</option>
                    <option value="Blue Dart">Blue Dart</option>
                    <option value="Delhivery">Delhivery</option>
                    <option value="Ekart">Ekart</option>
                    <option value="Xpressbees">Xpressbees</option>
                    <option value="Ecom Express">Ecom Express</option>
                    <option value="Shadowfax">Shadowfax</option>
                    <option value="Amazon">Amazon</option>
                    <option value="Professional">Professional</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium mb-1">Tracking ID *</label>
                <input type="text" id="dispatchTrackingId" placeholder="Enter tracking number"
                    class="w-full border-2 rounded-xl px-4 py-3">
            </div>
            <div class="flex gap-3">
                <button type="button" onclick="closeModal('dispatchModal')"
                    class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-xl font-medium">Cancel</button>
                <button type="button" onclick="confirmDispatch()"
                    class="flex-1 bg-purple-600 text-white py-3 rounded-xl font-medium hover:bg-purple-700">ğŸšš
                    Dispatch</button>
            </div>
        </div>
    </div>
</div>

<!-- Register Department Modal -->
<div id="registerDeptModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
    <div class="bg-white rounded-2xl max-w-md w-full">
        <div class="bg-indigo-600 text-white p-4 rounded-t-2xl">
            <h3 class="font-bold text-lg">â• Register Department</h3>
        </div>
        <div class="p-6 space-y-4">
            <div>
                <label class="block text-sm font-medium mb-1">Department Name</label>
                <input type="text" id="newDeptName" placeholder="e.g., Address Team"
                    class="w-full border-2 rounded-xl px-4 py-3">
            </div>
            <div>
                <label class="block text-sm font-medium mb-1">Department ID</label>
                <input type="text" id="newDeptId" placeholder="e.g., ADDR001"
                    class="w-full border-2 rounded-xl px-4 py-3">
            </div>
            <div>
                <label class="block text-sm font-medium mb-1">Password</label>
                <input type="password" id="newDeptPass" class="w-full border-2 rounded-xl px-4 py-3">
            </div>
            <div>
                <label class="block text-sm font-medium mb-1">Department Type</label>
                <select id="newDeptType" class="w-full border-2 rounded-xl px-4 py-3">
                    <option value="verification">ğŸ“ Verification Department</option>
                    <option value="dispatch">ğŸ“¦ Dispatch Department</option>
                    <option value="delivery">ğŸšš Delivery Department</option>
                </select>
            </div>
            <div class="flex gap-3">
                <button type="button" onclick="closeModal('registerDeptModal')"
                    class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-xl font-medium">Cancel</button>
                <button type="button" onclick="registerDepartment()"
                    class="flex-1 bg-indigo-600 text-white py-3 rounded-xl font-medium hover:bg-indigo-700">âœ…
                    Register</button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Department Modal (Full Edit) -->
<div id="editDeptModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-[60]">
    <div class="bg-white rounded-2xl max-w-md w-full">
        <div class="bg-orange-600 text-white p-4 rounded-t-2xl flex justify-between items-center">
            <h3 class="font-bold text-lg">âœï¸ Full Edit Department</h3>
            <button type="button" onclick="closeModal('editDeptModal')"
                class="text-2xl hover:bg-white/20 w-8 h-8 rounded-full">Ã—</button>
        </div>
        <div class="p-6 space-y-4">
            <input type="hidden" id="editDeptOldId">
            <div class="bg-yellow-50 border border-yellow-300 rounded-xl p-3 text-sm text-yellow-800">
                âš ï¸ <strong>Warning:</strong> ID change karne se purani ID delete ho jayegi aur nayi ban jayegi!
            </div>
            <div>
                <label class="block text-sm font-medium mb-1">Department ID *</label>
                <input type="text" id="editDeptNewId" placeholder="e.g., ADDR001"
                    class="w-full border-2 rounded-xl px-4 py-3 font-mono">
                <p class="text-xs text-gray-500 mt-1">Current ID shown above. Change if needed.</p>
            </div>
            <div>
                <label class="block text-sm font-medium mb-1">Department Name *</label>
                <input type="text" id="editDeptName" placeholder="e.g., Verification Team"
                    class="w-full border-2 rounded-xl px-4 py-3">
            </div>
            <div>
                <label class="block text-sm font-medium mb-1">Password *</label>
                <input type="password" id="editDeptPass" placeholder="Enter new password"
                    class="w-full border-2 rounded-xl px-4 py-3">
                <p class="text-xs text-gray-500 mt-1">New password set hoga</p>
            </div>
            <div>
                <label class="block text-sm font-medium mb-1">Department Type *</label>
                <select id="editDeptType" class="w-full border-2 rounded-xl px-4 py-3">
                    <option value="verification">ğŸ“ Verification Department</option>
                    <option value="dispatch">ğŸ“¦ Dispatch Department</option>
                    <option value="delivery">ğŸšš Delivery Department</option>
                </select>
            </div>
            <div class="flex gap-3 pt-2">
                <button type="button" onclick="closeModal('editDeptModal')"
                    class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-xl font-medium">Cancel</button>
                <button type="button" onclick="deleteDepartment()"
                    class="bg-red-400 text-white px-4 py-3 rounded-xl font-medium hover:bg-red-500">ğŸ—‘ï¸</button>
                <button type="button" onclick="updateDepartmentFull()"
                    class="flex-1 bg-orange-600 text-white py-3 rounded-xl font-medium hover:bg-orange-700">ğŸ’¾ Save
                    All</button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Employee Modal -->
<div id="editEmployeeModal" class="hidden fixed inset-0 bg-black/50 flex items-start justify-center p-4 z-[60] pt-20">
    <div class="bg-white rounded-2xl max-w-md w-full">
        <div class="bg-orange-600 text-white p-4 rounded-t-2xl flex justify-between items-center">
            <h3 class="font-bold text-lg">âœï¸ Edit Employee Details</h3>
            <button type="button" onclick="closeModal('editEmployeeModal')"
                class="text-2xl hover:bg-white/20 w-8 h-8 rounded-full">Ã—</button>
        </div>
        <div class="p-6 space-y-4">
            <input type="hidden" id="editEmpOldId">
            <div class="bg-yellow-50 border border-yellow-300 rounded-xl p-3 text-sm text-yellow-800">
                âš ï¸ <strong>Warning:</strong> ID change karne par login details badal jayengi!
            </div>
            <div>
                <label class="block text-sm font-medium mb-1 text-slate-600">Employee Name *</label>
                <input type="text" id="editEmpName" placeholder="Enter Full Name"
                    class="w-full border-2 rounded-xl px-4 py-3 focus:border-orange-500 outline-none transition-all">
            </div>
            <div>
                <label class="block text-sm font-medium mb-1 text-slate-600">Employee ID *</label>
                <input type="text" id="editEmpNewId" placeholder="e.g., HON-E001"
                    class="w-full border-2 rounded-xl px-4 py-3 font-mono focus:border-orange-500 outline-none transition-all">
            </div>
            <div>
                <label class="block text-sm font-medium mb-1 text-slate-600">New Password (Leave blank for no
                    change)</label>
                <input type="password" id="editEmpPass" placeholder="Enter new password"
                    class="w-full border-2 rounded-xl px-4 py-3 focus:border-orange-500 outline-none transition-all">
            </div>
            <div class="flex gap-3 pt-2">
                <button type="button" onclick="closeModal('editEmployeeModal')"
                    class="flex-1 bg-gray-100 text-gray-700 py-3 rounded-xl font-bold hover:bg-gray-200 transition-all">Cancel</button>
                <button type="button" onclick="saveEmployeeChanges()"
                    class="flex-1 bg-orange-600 text-white py-3 rounded-xl font-bold hover:bg-orange-700 shadow-lg shadow-orange-200 transition-all">ğŸ’¾
                    Save Changes</button>
            </div>
        </div>
    </div>
</div>

<!-- Employee Profile Modal -->
<div id="employeeProfileModal" class="hidden fixed inset-0 bg-black/50 flex items-start justify-center p-4 z-50 pt-10">
    <div class="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
        <div class="sticky top-0 bg-indigo-600 text-white p-4 rounded-t-2xl flex justify-between items-center">
            <h3 class="font-bold text-lg">ğŸ‘¤ Employee Profile</h3>
            <button type="button" onclick="closeModal('employeeProfileModal')"
                class="text-2xl hover:bg-white/20 w-8 h-8 rounded-full">Ã—</button>
        </div>
        <div id="employeeProfileContent" class="p-6"></div>
    </div>
</div>

<!-- Order Detail Modal with Map -->
<div id="orderDetailModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
    <div class="bg-white rounded-2xl max-w-5xl w-full max-h-[90vh] overflow-y-auto relative">
        <div id="orderDetailContent" class="p-0">
            <!-- Content will be populated by viewOrder() function -->
        </div>
    </div>
</div>

<!-- DISTRICT EXPLORER MODAL -->
<div id="districtExplorerModal"
    class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
    <div
        class="bg-white w-full max-w-4xl max-h-[90vh] rounded-2xl shadow-2xl flex flex-col animate-scaleIn overflow-hidden">
        <!-- Header -->
        <div
            class="bg-gradient-to-r from-blue-600 to-indigo-600 p-6 flex justify-between items-center text-white shrink-0">
            <div>
                <h3 class="text-2xl font-bold flex items-center gap-2">
                    <span>ğŸ—ºï¸</span>
                    <span id="districtExplorerTitle">District Explorer</span>
                </h3>
                <p class="text-blue-100 text-sm mt-1">Select a Taluka (Block) to see Post Offices</p>
            </div>
            <button onclick="closeModal('districtExplorerModal')"
                class="bg-white/20 hover:bg-white/30 text-white rounded-full p-2 transition-colors">âœ•</button>
        </div>

        <!-- Body -->
        <div class="flex-1 overflow-hidden flex flex-col md:flex-row">
            <!-- Left: Talukas -->
            <div class="md:w-1/3 bg-gray-50 border-r border-gray-200 flex flex-col">
                <div class="p-4 bg-gray-100 border-b font-bold text-gray-700 flex justify-between">
                    <span>ğŸ›ï¸ Taluka / Block</span>
                    <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full"
                        id="talukaCountBadge">0</span>
                </div>
                <div id="talukasList" class="flex-1 overflow-y-auto p-2 space-y-2">
                    <!-- Taluka items will be injected here -->
                    <div class="p-4 text-center text-gray-500">Loading...</div>
                </div>
            </div>

            <!-- Right: Post Offices -->
            <div class="md:w-2/3 flex flex-col bg-white">
                <div
                    class="p-4 bg-white border-b font-bold text-gray-700 flex justify-between items-center shadow-sm z-10">
                    <span>ğŸ“® Post Offices</span>
                    <input type="text" placeholder="ğŸ” Filter Offices..."
                        class="border rounded-lg px-3 py-1 text-sm focus:ring-2 focus:ring-blue-500 outline-none"
                        oninput="filterExplorerOffices(this.value)">
                </div>
                <div id="postOfficesList"
                    class="flex-1 overflow-y-auto p-4 grid grid-cols-1 md:grid-cols-2 gap-3 content-start">
                    <!-- Post Office items will be injected here -->
                    <div class="col-span-full text-center text-gray-400 py-10">
                        ğŸ‘ˆ Select a Taluka from the left to view Post Offices
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* Ensure edit modal shows properly when not hidden */
    #editOrderModal:not(.hidden) {
        display: flex !important;
    }
</style>